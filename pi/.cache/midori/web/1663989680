var g_fModuleLoaded={},g_rgWin=[],g_iWns=0,g_rgsSigrEM,g_rgsSigrCN,g_rgsIss,g_rgiSigCa,g_rgsSigSt,g_rgsSigDt,g_iSig=0,g_iMxHtSl,g_oDlgSDtl=0,g_iSDDW=500,g_iSDDH=300;!g_fModuleLoaded["freadmsg.js".toLowerCase()]&&(function(){Type.createNamespace("Owa.Pages");Owa.Pages.ReadMessagePage=function Owa$Pages$ReadMessagePage(a){if(a.get_TagName()!="BODY")this._fSupportHostedInSubPage=true;Owa.Pages.ReadMessagePage.constructBase(this,[a])};var a=Owa.Pages.ReadMessagePage.prototype;a.initialize=function Owa$Pages$ReadMessagePage$initialize(){Owa.Pages.ReadMessagePage.callBase(this,"initialize");if(!this.get_IsPreview()){var b=Owa.Dom.Window.get_Current();b.attachEvent("beforeprint",befPrn);b.attachEvent("afterprint",aftPrn)}Owa.Components.ToolbarCollection.get(this.get_SubPage()).addToolbars(["tblARTB"],this.get_ActionTable());this.safeResizeWells();initMmCtl();if(g_oMmBdy){initSIT();initMmAtt();cTBS(true);ldMsgMm(getIdQS(),pstMmDec)}var a=0,c=this._getDescendant("spnFrom");if(c)a=isBuddy(gtRcpIM(c));this._setTimeout(updFrmPrsnc,IM_PRTM_FRM,this.get_SubPage());enbIMBtns(this.get_SubPage(),g_fIsIMEnab,a,this.get_IsPhishing());addPerfMarker("ReadMessage.Init.End");isOfClss(this.get_ItemClassName(),IT_SHR)&&this.get_ActionTable().getAction("forward").disable()};a.dispose=function Owa$Pages$ReadMessagePage$dispose(){if(this.get_IsDisposed())return;hdPrgrsInd();isDf(typeof g_oDlgSndEm)&&g_oDlgSndEm&&g_oDlgSndEm.hide();g_oDlgSDtl&&g_oDlgSDtl.hide();dispReadWells(this.get_SubPage());Owa.Pages.ReadMessagePage.callBase(this,"dispose")};a.get_LocApproval=function Owa$Components$ReadMessagePage$get_LocApproval(){return this.getSubPageVariable("a_sLocApproval")};a.get_LocReject=function Owa$Components$ReadMessagePage$get_LocReject(){return this.getSubPageVariable("a_sLocReject")};a._onUserAction=function Owa$Pages$ReadMessagePage$_onUserAction(c,a){switch(c){case"replyall":this._smimeReplyForwardItem("ReplyAll");break;case"reply":this._smimeReplyForwardItem("Reply");break;case"sendAgain":this._replyForwardItem(this.get_ItemClassName(),"SendAgain",this.get_IsPreview());break;case"forward":this._smimeReplyForwardItem("Forward");break;case"approve":this._processApproval(APV_SND,APV_APP);break;case"reject":this._processApproval(APV_SND,APV_REJ);break;case"apvedrsp":this._processApproval(APV_EDT,getApv(a));break;case"apvsndrsp":this._processApproval(APV_SND,getApv(a));break;case"messagenotetoolbar":var b=Owa.UIControls.MessageAnnotationDialog.get_Default();b.set_Item(this.get_ItemId());b.show();break;default:Owa.Pages.ReadMessagePage.callBase(this,"_onUserAction",[c,a])}};a._onNewItem=function Owa$Pages$ReadMessagePage$_onNewItem(){if(isOfClss(this.get_ItemClassName(),IT_SMS))newSms(this);else newMail(false,this)};a._resizeWellsInternal=function Owa$Pages$ReadMessagePage$WellsInternal(){var a=["divSentL","divToL","divCcL","divBccL"];this._getDescendant("divSign")&&this._getDescendant("divSign").get_IsShown()&&a.push("divSignL");this._getDescendant("divWellCategories").get_IsShown()&&a.push("divCategoriesL");this._getDescendant("divWellAttach")&&this._getDescendant("divWellAttach").get_IsShown()&&a.push("divAttachL");Owa.Layout.setElementWidthsToLargest(a);Owa.Pages.ReadMessagePage.callBase(this,"_resizeWellsInternal")};a._fApproval=0;a._processApproval=function Owa$Pages$ReadMessagePage$_processApproval(d,a){if(this._fApproval)return;if(a==APV_APP&&this.get_LocApproval()!="")a=this.get_LocApproval();else if(a==APV_REJ&&this.get_LocReject()!="")a=this.get_LocReject();var c={};c.sOp=d;c.sVt=a;var b=new oeReq("ReadMessage",d,c,this._createCallback(this._cbProcessApproval));b.add("Id",this.get_ItemId());b.add("CK",this.get_ChangeKey());b.add("fId",this.get_FolderId());b.add("Vt",a);this._fApproval=1;b.send()};a._cbProcessApproval=function Owa$Pages$ReadMessagePage$_cbProcessApproval(d){if(this.get_IsDisposed())return;if(this._fApproval)this._fApproval=0;if(!cbOeh(d))return;var f=d.oCtx;if(f.sOp==APV_EDT){var b=Owa.Dom.Document.get_Current().createElement("div");b.set_InnerHtml(d.sBody);if(b.getDescendantById("itemId")){var e=b.getDescendantById("itemId").get_TextContent(),c="?ae=Item&t=IPM.Note&a=New&id="+urlEnc(e);if(this.get_IsPreview())opnWin(c,null,null,null,null,null,null,this.get_SubPage());else try{var a=this.get_SubPageController().get_OpenerController();a&&a.invokeFunction("openItm",[c,null,null,null,null,null,a.get_SubPage()])}catch(g){opnWin(c,null,null,null,null,null,null,this.get_SubPage())}}else alrt(L_ErrApvOpRsp)}!this.get_IsPreview()&&self.close();rfMailVw(this.get_IsPreview(),true,this.get_SubPage())};a._smimeReplyForwardItem=function Owa$Pages$ReadMessagePage$_smimeReplyForwardItem(b){if(g_oMmBdy){attchEvt(window,"beforeunload",onFWCld);var a=this._replyForwardItem(this.get_ItemClassName(),b,1);if(a){g_rgWin[g_iWns]=a;g_iWns++}}else var a=this._replyForwardItem(this.get_ItemClassName(),b,this.get_IsPreview())};Owa.Pages.ReadMessagePage.createClass("Owa.Pages.ReadMessagePage",Owa.Pages.ReadMessageFormSubPage)})();g_fModuleLoaded["freadmsg.js".toLowerCase()]=1;function getApv(a){while(a&&!a.hasCssClass("subMenu"))a=a.get_ParentElement();return a.get_Id().indexOf("approve")!=-1?APV_APP:a.get_Id().indexOf("reject")!=-1?APV_REJ:void 0}function IsSubPageDisposed(){return Owa.UIControls.SubPage.get_Instance().get_IsDisposed()}function onMmActEnd(){if(IsSubPageDisposed())return;var a=event.getAttribute("action").toLowerCase();if(a=="decodemime")onDecEnd();else a=="load"&&onLdEnd()}function onMmExCtBlk(){if(IsSubPageDisposed())return;replaceOrInsertInfobarMessage(a_sWBIB,"divWBIB");var c=Owa.UIControls.SubPage.get_Instance(),a=c._getDescendant("divWBIB"),b=a.getDescendantById("aIbBlk");b.attachEvent("click",rldExCt)}function rldExCt(){g_oMmBdy.reloadExternalContent();checkRemoveInfobarMessage("divWBIB");!a_fEmb&&!a_fP&&savRMsg("ReadMessage","AlWbBcn",1,a_fPrv)}function onFWCld(){if(!canCls())return L_RFCnA}function canCls(){for(var a=0;a<g_rgWin.length;a++)if(g_rgWin[a]&&!g_rgWin[a].closed&&g_rgWin[a].g_fDataTran)return false;return true}function onLdEnd(){if(!event.getAttribute("hasWinmailTnefAttachment"))return;replaceOrInsertInfobarMessage(L_UkAtt)}function isDecSigErr(a){return a==2148077570||a==2148323063||a==2148077575}function onDecEnd(){var a=hres(getEvErr()),b=a==2148077575,e=a==2148081680;hdPrgrsInd();cTBS(false);g_oMmBdy.encrypted&&shEnI();g_rgiSigCa=[];g_rgsSigSt=[];g_rgsSigDt=[];if(a!=0){var c=getEvExtErr();if(!e&&!(b&&c&256)){if(a_fOpSigOrEn){var d=wda("divErr");showSMErr(d,a,CTS_LD,c);if(g_oMmBdy.Signed&&g_oMmBdy.encrypted)d.all.tdMsg.innerHTML+="<br>"+htmlEnc(L_CtVlSg)}if(g_oMmBdy.Signed&&isDecSigErr(a)){shwSigRes(new Array(a.toString()));!a_fOpSigOrEn&&rdAW()}g_MMRdy_Stat&=MMRdy_Frm;readFmUpdCmp(window);return}}rdAW();!b&&g_oMmBdy.Signed&&valCert();g_MMRdy_Stat&=MMRdy_Frm;readFmUpdCmp(window)}function rdAW(){var d=new MsgInfo(a_fJoP,a_fEmb,a_fRp,a_iEmbD),c=new AttPlcy,b=getAIs(g_oMmBdy.attachments,c,d,AWT_RO,a_fEnIL);b&&rdAttWl(b,AWT_RO,d,c,wda("divAtch"),true);var a=Owa.UIControls.SubPage.get_Instance();a.resizeAttachmentWell()&&a.safeResizeWells()}function pstMmDec(){if(g_oMmBdy.DOM.readyState!="complete"){setTimeout(pstMmDec,100);return}shMmBdy();var a=Owa.UIControls.SubPage.get_Instance();a.safeResizeBodies();g_MMRdy_Stat&=MMRdy_Bdy;readFmUpdCmp(window)}function cTBS(d){for(var c=document.getElementsByName("lnkB"),b=0;b<c.length;++b){var a=c[b];switch(a.id){case"reply":case"replyall":case"crrul":case"forward":case"flag":case"cat":case"messagedetails":case"print":if(d)a._st=cntnCls(a,"btnDa")?0:1;a._st&&enblB(a.id,d)}}}function shEnI(){var a=document.getElementById("spEn");a&&showEm(a)}var g_iVCTmId=0;function upUIBVC(){g_iVCTmId=0;shwSiLn();shwSiVaEs()}function valCert(){if(!g_oMmBdy)return;g_iVCTmId=setTimeout(upUIBVC,g_iPrgIndDly);var c=g_oMmBdy.signatures.toArray(),b=g_oMmBdy.certificateChains.toArray(),a=new oeReq("SMime","ValidateCerts",0,cbValCert,POST);a.addRg("certs",c);a.addRg("chains",b);a.add("isSend",0);a.send()}function cbValCert(a){if(!cbOeh(a))return;if(g_iVCTmId)clearTimeout(g_iVCTmId);else HdSiVaEs();chkSiVaRes(a)}function shwSiLn(){var b=wda("divSign");if(b){showEm(b);var a=Owa.UIControls.SubPage.get_Instance();a.safeResizeWells();a.safeResizeBodies()}}function shwSiVaEs(){var a=wda("spSigPro");a&&showEm(a)}function HdSiVaEs(){var a=wda("spSigPro");a&&hideEm(a)}function rdSiVaRes(){var e=wda("spnSigRes");if(e){for(var a="",c=-1,b=g_iSig-1;b>=0;b--)if(g_rgiSigCa[b]!=0&&g_rgiSigCa[b]!=1){c=b;break}if(c!=-1){a+='<span id=spSRI><a href="#" onclick="shwSDtlDlg('+b+');">';a+=Owa.Components.CssSprites.getImageMarkup("siginvalid.gif",'alt="'+htmlEnc(g_rgsSigSt[c])+'"',"",null);a+="</a></span>";a+='<span id=spSiErrInLi title="'+htmlEnc(g_rgsSigSt[c])+'">';a+=htmlEnc(L_SgVldF);a+="</span>";a+="<span id=spSMI>";a+=g_sDE;a+=htmlEnc(L_OpPT);a+='<a id=signLnk href="#" onclick="shwSDtlDlg('+c+');">'+htmlEnc(L_MrInf)+"</A>";a+=g_sDE;a+=htmlEnc(L_CdPT);a+="</span>"}else for(var f=1,g={},b=g_iSig-1;b>=0;b--){if(g[g_rgsSigrEM[b]])continue;g[g_rgsSigrEM[b]]=1;if(f){a+='<span id=spSRI><a href="#" onclick="shwSDtlDlg('+b+');">';f=0}else a+='; <span id=spSRI><a href="#" onclick="shwSDtlDlg('+b+');">';var d="";switch(g_rgiSigCa[b]){case 0:d="sigvalid.gif";break;case 1:d="sigwarning.gif"}a+=Owa.Components.CssSprites.getImageMarkup(d,'alt="'+htmlEnc(g_rgsSigSt[b])+'" tabindex="-1"',"",null);a+="</a></span>";a+='<span id=spSigner title="'+htmlEnc(g_rgsSigrCN[b])+'" >';a+=htmlEnc(g_rgsSigrEM[b]);a+="</span>";a+="<span id=spSMI>";a+=g_sDE;a+=htmlEnc(L_OpPT);a+='<a id=signLnk href="#" tabindex="-1" onclick="shwSDtlDlg('+b+');">'+htmlEnc(L_MrInf)+"</A>";a+=g_sDE;a+=htmlEnc(L_CdPT);a+="</span>"}e.innerHTML=a;initSl();showEm(e)}}var SIGN_ICON_HT=16;function initSl(){var a=wda("spnSigRes");if(!a)return;var b=a.currentStyle;g_iMxHtSl=2*getInt("0"+b.padding)+2*getInt("0"+b.borderWidth)+Math.max(2*a.scrollHeight,2*SIGN_ICON_HT)+2;rszSl()}function rszSl(){var a=wda("spnSigRes");if(!a||!g_iSig)return;a.style.pixelHeight=Math.min(a.scrollHeight,g_iMxHtSl)}function chkSiVaRes(k){var b=getEm("div");ac(b);b.innerHTML=k.sBody;var c=b.all.res,i=b.all.eml,j=b.all.cn,h=b.all.issuer,e=[],d=[],g=[],f=[];if(!isRg(c)){e[0]=c.innerText;d[0]=i.innerText;g[0]=j.innerText;f[0]=h.innerText}else for(var a=0;a<c.length;a++){e[a]=c[a].innerText;d[a]=i[a].innerText;g[a]=j[a].innerText;f[a]=h[a].innerText}rn(b);shwSigRes(e,d,g,f)}function shwSigRes(c,b,e,d){g_rgsSigrEM=[];g_rgsSigrCN=[];g_rgsIss=[];g_iSig=c.length;for(var a=0;a<g_iSig;a++){g_rgsSigrEM[a]=b?b[a]:"";g_rgsSigrCN[a]=e?e[a]:"";g_rgsIss[a]=d?d[a]:"";var f=c[a];g_rgiSigCa[a]=gtSgnErCt(parseInt(f));switch(g_rgiSigCa[a]){case 0:g_rgsSigSt[a]=L_SigStP;break;case 1:g_rgsSigSt[a]=L_SigStW;break;case 2:g_rgsSigSt[a]=L_SigStF;break;default:g_rgsSigSt[a]=L_SigStF}g_rgsSigDt[a]=mapETS(parseInt(f),CTS_SV,2)}shwSiLn();rdSiVaRes()}function updSDlgInfo(b){var j=wda("tdSsSs");if(j)j.innerText=g_rgsSigSt[b];var i=wda("tdSsEs");if(i)i.innerText=g_rgsSigDt[b];var a;a=wda("imgDVS");a&&hideEm(a);a=wda("imgDWS");a&&hideEm(a);a=wda("imgDIVS");a&&hideEm(a);switch(g_rgiSigCa[b]){case 0:a=wda("imgDVS");break;case 1:a=wda("imgDWS");break;case 2:a=wda("imgDIVS");break;default:a=wda("imgDIVS")}a&&showEm(a);if(g_oMmBdy.encrypted){var e=wda("trSigDlgEn");e&&showEm(e)}if(g_rgiSigCa[b]!=2){var m=getSSubj(g_oMmBdy),l=getSSdr(g_oMmBdy),d=wda("siInBdy");d&&showEm(d);var c=wda("siErrBdy");c&&hideEm(c);var k=wda("tdSubj");if(k)k.innerText=m;var h=wda("tdFrom");if(h)h.innerText=l;var g=wda("tdSigBy");if(g)g.innerText=g_rgsSigrEM[b];var f=wda("tdIssBy");if(f)f.innerText=g_rgsIss[b]}else{var d=wda("siInBdy");d&&hideEm(d);var c=wda("siErrBdy");c&&showEm(c)}}function shwSDtlDlg(b){var a=wda("divSDtl");if(a){updSDlgInfo(b);g_oDlgSDtl=new BtnDlg("divSDtlDlg",a.innerHTML,L_SDtl,new Array(L_OK),g_iSDDW,null,cbClsSDtlDlg);g_oDlgSDtl.show()}}function cbClsSDtlDlg(){g_oDlgSDtl=0}function befPrn(){if(!g_oMmBdy)return;var f=wda("divBdy");if(f)f.style.bottom="auto";var c=wda("dvPrnMsgBdy");if(c){showEm(c);c.innerHTML=g_oMmBdy.DOM.body.innerHTML;hideEm(g_oMmBdy)}var e=wda("divAtch");if(e)e.className="awPr";var d=wda("spnSigRes");if(d)d.className="slPr";var a=wda("spSMI"),b;if(a)if(isRg(a))for(b=0;b<a.length;b++)hideEm(a[b]);else hideEm(a);var g=wda("tblTB");g&&hideEm(g)}function aftPrn(){if(!g_oMmBdy)return;var f=wda("divBdy");if(f)f.style.bottom="";var c=wda("dvPrnMsgBdy");if(c){hideEm(c);c.innerHTML="";showEm(g_oMmBdy)}var e=wda("divAtch");if(e)e.className="awRO";var d=wda("spnSigRes");if(d)d.className="sl";var a=wda("spSMI"),b;if(a)if(isRg(a))for(b=0;b<a.length;b++)showEm(a[b]);else showEm(a);var g=wda("tblTB");g&&showEm(g)}function getSigTxt(a,b){return b?b:a?a:""}function getSSubj(b){var a;try{a=b.headers.Subject}catch(c){a=""}return a}function getSSdr(c){var b,a;try{b=c.headers.From;a=b.toString("%1").toString("%1&nbsp;"+g_sDE+"[%2"+g_sDE+"]")}catch(d){a=""}return a}function onLocalLink(d,b){b=Owa.Dom.Node.wrapDomNode(b);var c=b.get_ContentWindow().get_Document(),a=c.getElementsByName(d);if(a&&a.length>0)a[0].scrollIntoView(true);else{a=c.getElementById(d);a&&a.scrollIntoView(true)}}stJS("freadmsg.js")